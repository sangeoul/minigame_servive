<script>
    var __extends=(this&&this.__extends)||(function(){var a=function(d,b){a=Object.setPrototypeOf||({__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b})||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return a(d,b)};return function(d,b){a(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __())}})();var WIDTH=500;var HEIGHT=500;var UNIT_RADIUS_DEFAULT=10;var PLAYER_RADIUS_RATE=1.8;var UNIT_VELOCITY_DEFAULT=140;var ENEMY1_VELOCITY_RATE=0.65;var ENEMY2_VELOCITY_RATE=1.3;var FRAMETIME=15;var KEYCODE_W=87;var KEYCODE_A=65;var KEYCODE_S=83;var KEYCODE_D=68;var SPAWN_INTERVAL=3500;var SPAWN_INCREASE_SCALE=1.2;var ITEM1_EXPAND_SPEED=80;var ITEM1_LIFETIME=1500;var ITEM1_SPAWN_KILLCOUNT_START=40;var ITEM1_SPAWN_KILLCOUNT_PROBABILITY=0.06;var ITEM1_SPAWN_KILLCOUNT=40;var ITEM2_RANGE=200;var ITEM2_ATTACK_DELAY=300;var ITEM2_LIFETIME=7000;var ITEM2_SPAWN_KILLCOUNT_START=80;var ITEM2_SPAWN_KILLCOUNT_PROBABILITY=0.04;var ITEM2_SPAWN_KILLCOUNT=68;var EFFECT2_LIFETIME=200;var COLOR_LIGHTBLUE="#89D1FE";var div_score;var span_killscore;var maincanvas;var div_explain;var ctx;var rightPressed;var leftPressed;var upPressed;var downPressed;var starttime;var frametime;var spawntime;var spawncount=0;var killcount=0;var gameover=false;var player;var enemies;var items;var effects;var item_probability_count;var mouseX,mouseY;var intervalobject;function init(){maincanvas=document.createElement("canvas");div_score=document.createElement("div");span_killscore=document.createElement("span");div_explain=document.createElement("div");div_score.innerHTML="Kill : ";div_score.style.fontSize="28px";div_score.appendChild(span_killscore);ctx=maincanvas.getContext("2d");maincanvas.width=WIDTH;maincanvas.height=HEIGHT;div_explain.innerHTML="WASD : 이동 <br> 마우스 이동으로 탄 소거. 클릭으로 아이템 사용.";maincanvas.onmousemove=function(e){mouseX=e.clientX-maincanvas.getBoundingClientRect().left;mouseY=e.clientY-maincanvas.getBoundingClientRect().top};maincanvas.onmousedown=function(e){mouseX=e.clientX-maincanvas.getBoundingClientRect().left;mouseY=e.clientY-maincanvas.getBoundingClientRect().top;useItem()};var a=new Path2D();a.rect(1,1,WIDTH-1,HEIGHT-1);ctx.stroke(a);player=new playerObject(WIDTH/2,HEIGHT/2);enemies=new Array();items=new Array();items[0]=new itemObject(0,0,0);effects=new Array();player.Drawing();item_probability_count=new Array();item_probability_count[0]=0;item_probability_count[1]=0;item_probability_count[2]=0;rightPressed=false;leftPressed=false;upPressed=false;downPressed=false;document.addEventListener("keydown",KeyDownHandler,false);document.addEventListener("keyup",KeyUpHandler,false);document.body.appendChild(div_score);document.body.appendChild(maincanvas);document.body.appendChild(div_explain);alert("Ready");starttime=new Date().getTime();frametime=new Date().getTime();spawntime=new Date().getTime();intervalobject=setInterval(processFrame,FRAMETIME)}function KeyDownHandler(e){switch(e.keyCode){case KEYCODE_W:upPressed=true;break;case KEYCODE_A:leftPressed=true;break;case KEYCODE_S:downPressed=true;break;case KEYCODE_D:rightPressed=true;break}}function KeyUpHandler(e){switch(e.keyCode){case KEYCODE_W:upPressed=false;break;case KEYCODE_A:leftPressed=false;break;case KEYCODE_S:downPressed=false;break;case KEYCODE_D:rightPressed=false;break}}var location_coor=(function(){function location_coor(x,y){this.x=x;this.y=y}return location_coor}());var unitObject=(function(){function unitObject(a,b,c,d){if(c==undefined){c=0}if(d==undefined){d=0}this.p=new location_coor(a,b);this.vx=c;this.vy=d;this.drawpath=new Path2D();this.radius=UNIT_RADIUS_DEFAULT}unitObject.prototype.Drawing=function(){};unitObject.prototype.Move=function(a){this.p.x+=this.vx*a/1000;this.p.y+=this.vy*a/1000;this.CheckOutBoundery()};unitObject.prototype.CheckOutBoundery=function(){if(this.p.x<0){this.p.x=0}else if(this.p.x>WIDTH){this.p.x=WIDTH}if(this.p.y<0){this.p.y=0}else if(this.p.y>HEIGHT){this.p.y=HEIGHT}};return unitObject}());var enemyObject=(function(e){__extends(enemyObject,e);function enemyObject(a,b,c){var d=this;if(c==undefined){c=1}d=e.call(this,a,b,0,0)||this;d.alive=true;d.unitType=c;return d}enemyObject.prototype.Move=function(a){var b=(player.p.x-this.p.x);var c=(player.p.y-this.p.y);if(this.unitType==1){this.vx=b*UNIT_VELOCITY_DEFAULT*ENEMY1_VELOCITY_RATE/Math.sqrt((b*b)+(c*c));this.vy=c*UNIT_VELOCITY_DEFAULT*ENEMY1_VELOCITY_RATE/Math.sqrt((b*b)+(c*c))}else if(this.unitType==2){this.vx=b*UNIT_VELOCITY_DEFAULT*ENEMY2_VELOCITY_RATE/Math.sqrt((b*b)+(c*c));this.vy=c*UNIT_VELOCITY_DEFAULT*ENEMY2_VELOCITY_RATE/Math.sqrt((b*b)+(c*c))}this.p.x+=this.vx*a/1000;this.p.y+=this.vy*a/1000};enemyObject.prototype.Drawing=function(){this.drawpath=new Path2D();this.drawpath.moveTo(this.p.x+this.radius,this.p.y);this.drawpath.arc(this.p.x,this.p.y,this.radius,0,2*Math.PI);if(this.unitType==1){ctx.fillStyle="gray"}else if(this.unitType==2){ctx.fillStyle="red"}ctx.fill(this.drawpath)};enemyObject.prototype.Dead=function(){if(this.alive==true){this.alive=false;killcount++;span_killscore.innerHTML=killcount+"";item_probability_count[1]+=ITEM1_SPAWN_KILLCOUNT_PROBABILITY;item_probability_count[2]+=ITEM2_SPAWN_KILLCOUNT_PROBABILITY;console.log(item_probability_count[1]);if(Math.random()<(item_probability_count[1]/100)){spawnItem(1);item_probability_count[1]=0}if(Math.random()<(item_probability_count[2]/100)){spawnItem(2);item_probability_count[2]=0}}};enemyObject.prototype.killOnMouse=function(a,b){if((this.p.x-a)*(this.p.x-a)+(this.p.y-b)*(this.p.y-b)<=(this.radius+(this.radius*Math.sqrt(PLAYER_RADIUS_RATE)))*(this.radius+(this.radius*Math.sqrt(PLAYER_RADIUS_RATE)))&&this.alive==true){this.Dead()}};enemyObject.prototype.checkGameOver=function(){if(checkTouch(this,player)&&this.alive==true){gameOver()}};return enemyObject}(unitObject));var playerObject=(function(d){__extends(playerObject,d);function playerObject(a,b){var c=d.call(this,a,b)||this;c.radius=UNIT_RADIUS_DEFAULT*Math.sqrt(PLAYER_RADIUS_RATE)-1;return c}playerObject.prototype.Drawing=function(){this.drawpath=new Path2D();this.drawpath.moveTo(this.p.x+this.radius,this.p.y);this.drawpath.arc(this.p.x,this.p.y,this.radius,0,2*Math.PI);ctx.fillStyle="blue";ctx.fill(this.drawpath)};playerObject.prototype.Move=function(a){var b=0;if(upPressed){b+=1}if(leftPressed){b+=2}if(downPressed){b+=4}if(rightPressed){b+=8}switch(b){case 0:this.vx=0;this.vy=0;break;case 1:this.vx=0;this.vy=-UNIT_VELOCITY_DEFAULT;break;case 2:this.vx=-UNIT_VELOCITY_DEFAULT;this.vy=0;break;case 3:this.vx=-0.7071*UNIT_VELOCITY_DEFAULT;this.vy=-0.7071*UNIT_VELOCITY_DEFAULT;break;case 4:this.vx=0;this.vy=UNIT_VELOCITY_DEFAULT;break;case 5:this.vx=0;this.vy=0;break;case 6:this.vx=-0.7071*UNIT_VELOCITY_DEFAULT;this.vy=0.7071*UNIT_VELOCITY_DEFAULT;break;case 7:this.vx=-UNIT_VELOCITY_DEFAULT;this.vy=0;break;case 8:this.vx=UNIT_VELOCITY_DEFAULT;this.vy=0;break;case 9:this.vx=0.7071*UNIT_VELOCITY_DEFAULT;this.vy=-0.7071*UNIT_VELOCITY_DEFAULT;break;case 10:this.vx=0;this.vy=0;break;case 11:this.vx=0;this.vy=-UNIT_VELOCITY_DEFAULT;break;case 12:this.vx=0.7071*UNIT_VELOCITY_DEFAULT;this.vy=0.7071*UNIT_VELOCITY_DEFAULT;break;case 13:this.vx=UNIT_VELOCITY_DEFAULT;this.vy=0;break;case 14:this.vx=0;this.vy=UNIT_VELOCITY_DEFAULT;break;case 15:this.vx=0;this.vy=0;break}this.p.x+=this.vx*a/1000;this.p.y+=this.vy*a/1000;this.CheckOutBoundery()};return playerObject}(unitObject));var itemObject=(function(f){__extends(itemObject,f);function itemObject(a,b,c,d){var e=this;if(d==undefined){d=1}e=f.call(this,a,b)||this;e.unitType=c;e.status=d;if(e.status==2){e.activetime=new Date().getTime();e.delaytime=new Date().getTime()}else{e.activetime=0;e.delaytime=0}if(e.unitType==2&&e.status==2){e.radius=ITEM2_RANGE}return e}itemObject.prototype.Move=function(a){if(this.status==1){if(checkTouch(this,player)){items[0].unitType=this.unitType;this.status=0}}if(this.unitType==1&&this.status==2){this.radius+=ITEM1_EXPAND_SPEED*a/1000;for(var i=0;i<enemies.length;i++){if(checkTouch(this,enemies[i])&&enemies[i].alive==true){enemies[i].Dead()}}if(this.activetime+ITEM1_LIFETIME<new Date().getTime()){this.status=0}}else if(this.unitType==2&&this.status==2){if(this.delaytime+ITEM2_ATTACK_DELAY<new Date().getTime()){this.delaytime+=ITEM2_ATTACK_DELAY;var b=-1,minimum=WIDTH+HEIGHT;for(var i=0;i<enemies.length;i++){if(checkTouch(this,enemies[i])&&enemies[i].alive==true){var c=Math.sqrt((enemies[i].p.x-this.p.x)*(enemies[i].p.x-this.p.x)+(enemies[i].p.y-this.p.y)*(enemies[i].p.y-this.p.y));if(c<minimum){b=i;minimum=c}}}if(b!=-1){enemies[b].Dead();spawnEffect(2,this.p,enemies[b].p)}}if(this.activetime+ITEM2_LIFETIME<new Date().getTime()){this.status=0}}};itemObject.prototype.Drawing=function(){var a=new Path2D();if(this.unitType==1){if(this.status==1){ctx.strokeStyle="orange";a.moveTo(this.p.x+this.radius,this.p.y);a.arc(this.p.x,this.p.y,this.radius,0,2*Math.PI);ctx.stroke(a);a=new Path2D();a.moveTo(this.p.x+(this.radius*0.6),this.p.y);a.arc(this.p.x,this.p.y,this.radius*0.6,0,2*Math.PI);ctx.fillStyle="red";ctx.fill(a)}else if(this.status==2){ctx.strokeStyle="orange";a.moveTo(this.p.x+this.radius,this.p.y);a.arc(this.p.x,this.p.y,this.radius,0,2*Math.PI);ctx.stroke(a)}}if(this.unitType==2){if(this.status==1||this.status==2){ctx.strokeStyle=COLOR_LIGHTBLUE;a.moveTo(this.p.x+this.radius,this.p.y);a.arc(this.p.x,this.p.y,this.radius,0,2*Math.PI);ctx.stroke(a);a=new Path2D();a.moveTo(this.p.x,this.p.y-UNIT_RADIUS_DEFAULT);a.lineTo(this.p.x+(UNIT_RADIUS_DEFAULT/2),this.p.y+(Math.sqrt(3)*UNIT_RADIUS_DEFAULT/2));a.lineTo(this.p.x,this.p.y);a.lineTo(this.p.x-(UNIT_RADIUS_DEFAULT/2),this.p.y+(Math.sqrt(3)*UNIT_RADIUS_DEFAULT/2));a.closePath();ctx.fillStyle=COLOR_LIGHTBLUE;ctx.fill(a)}}};return itemObject}(unitObject));var effectObject=(function(){function effectObject(a,b,c,d,e){if(b==undefined){b=1}this.unitType=a;this.status=b;this.starttime=new Date().getTime();if(this.unitType==2){this.v1=new location_coor(c.x,c.y);this.v2=new location_coor(d.x,d.y)}}effectObject.prototype.Move=function(a){if(this.unitType==2&&this.status>0){if(this.starttime+EFFECT2_LIFETIME<new Date().getTime()){this.status=0}}};effectObject.prototype.Drawing=function(){var a=new Path2D();if(this.unitType==2&&this.status==1){a.moveTo(this.v1.x,this.v1.y-UNIT_RADIUS_DEFAULT);a.lineTo(this.v2.x,this.v2.y);ctx.strokeStyle=COLOR_LIGHTBLUE;ctx.lineWidth=2;ctx.stroke(a)}};return effectObject}());function cleanCanvas(a){var b=a.getContext("2d");b.fillStyle="white";b.fillRect(0,0,a.width,a.height)}function processFrame(){var a=new Date().getTime();var b=SPAWN_INTERVAL*Math.log(SPAWN_INCREASE_SCALE)/Math.log((a-starttime+1000)/1000);if(a-spawntime>b){spawntime+=b;spawncount++;if(spawncount%20>0){spawnEnemy(1)}else{spawnEnemy(2)}}for(var i=0;i<enemies.length;i++){enemies[i].Move(a-frametime);enemies[i].killOnMouse(mouseX,mouseY);enemies[i].checkGameOver()}for(var i=1;i<items.length;i++){if(items[i].status>0){items[i].Move(a-frametime)}}for(var i=1;i<effects.length;i++){if(effects[i].status>0){effects[i].Move(a-frametime)}}player.Move(a-frametime);frametime=a;ctx.clearRect(0,0,WIDTH,HEIGHT);for(var i=0;i<enemies.length;i++){if(enemies[i].alive==true){enemies[i].Drawing()}}for(var i=1;i<items.length;i++){if(items[i].status>0){items[i].Drawing()}}for(var i=1;i<effects.length;i++){if(effects[i].status>0){effects[i].Drawing()}}mouseDrawing();player.Drawing()}function spawnEnemy(a){var b=Math.random()*4;var c=0,spawnY=0;if(b<1){c=b*WIDTH;spawnY=0}else if(b<2){c=WIDTH;spawnY=(b-1)*HEIGHT}else if(b<3){c=(b-2)*WIDTH;spawnY=HEIGHT}else{c=0;spawnY=(b-3)*HEIGHT}for(var i=0;i<enemies.length&&enemies[i].alive;i++);enemies[i]=new enemyObject(c,spawnY,a)}function spawnItem(a){var b=WIDTH*0.15+(Math.random()*WIDTH*0.7);var c=HEIGHT*0.15+(Math.random()*HEIGHT*0.7);console.log("spawn "+a);for(var i=1;i<items.length&&items[i].status>0;i++);items[i]=new itemObject(b,c,a)}function useItem(){for(var i=1;i<items.length&&items[i].status>0;i++);if(items[0].unitType==1){items[i]=new itemObject(mouseX,mouseY,1,2)}if(items[0].unitType==2){items[i]=new itemObject(mouseX,mouseY,2,2)}items[0].unitType=0}function spawnEffect(a,b,c,d){if(b==undefined){b=0}if(c==undefined){c=0}if(d==undefined){d=0}for(var i=1;i<effects.length&&effects[i].status>0;i++);effects[i]=new effectObject(a,1,b,c,d)}function mouseDrawing(){var a=new Path2D();a.moveTo(mouseX+UNIT_RADIUS_DEFAULT,mouseY);a.arc(mouseX,mouseY,UNIT_RADIUS_DEFAULT,0,2*Math.PI);if(items[0].unitType==0){ctx.strokeStyle="black";ctx.stroke(a)}if(items[0].unitType==1){ctx.fillStyle="orange";ctx.fill(a)}if(items[0].unitType==2){ctx.fillStyle=COLOR_LIGHTBLUE;ctx.fill(a)}}function gameOver(){gameover=true;clearInterval(intervalobject)}function checkTouch(a,b){if((a.p.x-b.p.x)*(a.p.x-b.p.x)+(a.p.y-b.p.y)*(a.p.y-b.p.y)<=(a.radius+b.radius)*(a.radius+b.radius)){return true}}
</script>
<html>
    <head>
       
    </head>
    <body onload="javascript:init();">
        
    </body>
</html>

